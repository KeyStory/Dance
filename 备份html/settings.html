{% extends "dance/layout.html" %}
{% block title %}
    Settings
{% endblock %}
{% block css %}
    {% load static %}
    <link rel="stylesheet" type="text/css" href="{% static 'dance/css/settings.css' %}"/>
{% endblock %}
{% block content %}
<div class="container">
    <div class="header">
        <h1>Settings</h1>
        <p>Manage your dance group settings</p>
    </div>

    <div class="tabs">
        <button class="tab-button active" data-tab="basic">
            <i>‚öôÔ∏è</i>
            Basic Settings
        </button>
        <button class="tab-button" data-tab="members">
            <i>üë•</i>
            Members Settings
        </button>
        <button class="tab-button" data-tab="notifications">
            <i>üîî</i>
            Notification Settings
        </button>
        <button class="tab-button" data-tab="privacy">
            <i>üîí</i>
            Privacy and Security
        </button>
        <button class="tab-button" data-tab="appearance">
            <i>üé®</i>
            Appearance Settings
        </button>
    </div>

    <div id="basic" class="tab-content active">
        <div class="setting-item">
            <div class="setting-info">
                <h3>Group Name</h3>
                <p>Set your dance group display name</p>
            </div>
            <div class="setting-control">
                <input type="text" class="input-field" name="groupName" placeholder="Enter Group Name">
            </div>
        </div>

        <div class="setting-item">
            <div class="setting-info">
                <h3>Automatic backup</h3>
                <p>Automatically back up group data every day</p>
            </div>
            <div class="setting-control">
                <label class="toggle-switch">
                    <input type="checkbox" name="autoBackup" checked>
                    <span class="slider"></span>
                </label>
            </div>
        </div>

        <div class="setting-item">
            <div class="setting-info">
                <h3>Multi-language support</h3>
                <p>Enable multi-language interface support</p>
            </div>
            <div class="setting-control">
                <label class="toggle-switch">
                    <input type="checkbox" name="multiLanguage">
                    <span class="slider"></span>
                </label>
            </div>
        </div>
    </div>

    <div id="members" class="tab-content">
        <div class="setting-item">
            <div class="setting-info">
                <h3>Member Approval</h3>
                <p>New members need to be reviewed</p>
            </div>
            <div class="setting-control">
                <label class="toggle-switch">
                    <input type="checkbox" name="memberApproval" checked>
                    <span class="slider"></span>
                </label>
            </div>
        </div>

        <div class="setting-item">
            <div class="setting-info">
                <h3>Attendance Record</h3>
                <p>Record member attendance</p>
            </div>
            <div class="setting-control">
                <label class="toggle-switch">
                    <input type="checkbox" name="attendance">
                    <span class="slider"></span>
                </label>
            </div>
        </div>
    </div>

    <div id="notifications" class="tab-content">
        <div class="setting-item">
            <div class="setting-info">
                <h3>Event Notification</h3>
                <p>Send event-related notifications</p>
            </div>
            <div class="setting-control">
                <label class="toggle-switch">
                    <input type="checkbox" name="eventNotifications" checked>
                    <span class="slider"></span>
                </label>
            </div>
        </div>

        <div class="setting-item">
            <div class="setting-info">
                <h3>System Notification</h3>
                <p>Send system related notifications</p>
            </div>
            <div class="setting-control">
                <label class="toggle-switch">
                    <input type="checkbox" name="systemNotifications">
                    <span class="slider"></span>
                </label>
            </div>
        </div>

        <div class="setting-item">
            <div class="setting-info">
                <h3>Notification method</h3>
                <p>Choose how you want to be notified</p>
            </div>
            <div class="setting-control">
                <div style="display: flex; flex-direction: column; gap: 8px;">
                    <label>
                        <input type="checkbox" name="notificationEmail" checked> Email Notification
                    </label>
                    <label>
                        <input type="checkbox" name="notificationSMS"> SMS Notification
                    </label>
                    <label>
                        <input type="checkbox" name="notificationApp" checked> In-app notifications
                    </label>
                </div>
            </div>
        </div>
    </div>

    <div id="privacy" class="tab-content">
        <div class="setting-item">
            <div class="setting-info">
                <h3>Data visibility</h3>
                <p>Control the visibility of member information</p>
            </div>
            <div class="setting-control">
                <select class="input-field" name="profileVisibility">
                    <option value="all">Visible to everyone</option>
                    <option value="members">Visible only to members</option>
                    <option value="staff">Visible only to staff</option>
                </select>
            </div>
        </div>

        <div class="setting-item">
            <div class="setting-info">
                <h3>Access restrictions</h3>
                <p>Set up access control</p>
            </div>
            <div class="setting-control">
                <select class="input-field" name="accessControl">
                    <option value="public">Public access</option>
                    <option value="private">Private access</option>
                    <option value="invitation">Invite only</option>
                </select>
            </div>
        </div>

        <div class="setting-item">
            <div class="setting-info">
                <h3>Data Protection</h3>
                <p>Enable Advanced Data Protection</p>
            </div>
            <div class="setting-control">
                <label class="toggle-switch">
                    <input type="checkbox" name="dataProtection" checked>
                    <span class="slider"></span>
                </label>
            </div>
        </div>
    </div>

    <div id="appearance" class="tab-content">
        <div class="setting-item">
            <div class="setting-info">
                <h3>Dark Mode</h3>
                <p>Enable Dark Theme</p>
            </div>
            <div class="setting-control">
                <label class="toggle-switch">
                    <input id="themeToggle" type="checkbox" name="darkMode">
                    <span class="slider"></span>
                </label>
            </div>
        </div>

        <div class="setting-item">
            <div class="setting-info">
                <h3>Theme Colors</h3>
                <p>Select system theme color</p>
            </div>
            <div class="setting-control">
                <input type="color" class="input-field" name="themeColor" value="#2196F3">
            </div>
        </div>

        <div class="setting-item">
            <div class="setting-info">
                <h3>Font size</h3>
                <p>Adjust the interface font size</p>
            </div>
            <div class="setting-control">
                <select class="input-field" name="fontSize">
                    <option value="small">Small</option>
                    <option value="medium" selected>Medium</option>
                    <option value="large">Large</option>
                </select>
            </div>
        </div>
    </div>

    <button class="save-button" id="saveSettings">Save Settings</button>
</div>

<div class="save-notification" id="saveNotification">
    Settings saved
</div>
{% endblock %}
{% block script %}
<script>
    // ÈÄâÈ°πÂç°ÂàáÊç¢ÂäüËÉΩ
    document.addEventListener('DOMContentLoaded', function() {
        const tabButtons = document.querySelectorAll('.tab-button');
        const tabContents = document.querySelectorAll('.tab-content');
        const saveButton = document.getElementById('saveSettings');
        const saveNotification = document.getElementById('saveNotification');
        let settings = {};

        // Âä†ËΩΩ‰øùÂ≠òÁöÑËÆæÁΩÆ
        loadSettings();

        // ÈÄâÈ°πÂç°ÂàáÊç¢
        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                // ÁßªÈô§ÊâÄÊúâÊ¥ªÂä®Áä∂ÊÄÅ
                tabButtons.forEach(btn => btn.classList.remove('active'));
                tabContents.forEach(content => content.classList.remove('active'));

                // Ê∑ªÂä†Êñ∞ÁöÑÊ¥ªÂä®Áä∂ÊÄÅ
                button.classList.add('active');
                const tabId = button.getAttribute('data-tab');
                document.getElementById(tabId).classList.add('active');
            });
        });

        // ÁõëÂê¨ÊâÄÊúâËæìÂÖ•ÂèòÂåñ
        document.querySelectorAll('input').forEach(input => {
            input.addEventListener('change', () => {
                if (input.type === 'checkbox') {
                    settings[input.name] = input.checked;
                } else {
                    settings[input.name] = input.value;
                }
            });
        });

        // ‰øùÂ≠òËÆæÁΩÆ
        saveButton.addEventListener('click', () => {
            // ‰øùÂ≠òËÆæÁΩÆÂà∞localStorage
            localStorage.setItem('danceGroupSettings', JSON.stringify(settings));

            // ÊòæÁ§∫‰øùÂ≠òÊèêÁ§∫
            saveNotification.style.display = 'block';
            setTimeout(() => {
                saveNotification.style.display = 'none';
            }, 3000);
        });

        // Âä†ËΩΩËÆæÁΩÆ
        function loadSettings() {
            const savedSettings = localStorage.getItem('danceGroupSettings');
            if (savedSettings) {
                settings = JSON.parse(savedSettings);
                // Â∫îÁî®‰øùÂ≠òÁöÑËÆæÁΩÆ
                Object.entries(settings).forEach(([key, value]) => {
                    const input = document.querySelector(`[name="${key}"]`);
                    if (input) {
                        if (input.type === 'checkbox') {
                            input.checked = value;
                        } else {
                            input.value = value;
                        }
                    }
                });
            }
        }
    });

    // Ê∑±Ëâ≤Ê®°ÂºèÂàáÊç¢ÈÄªËæë
    const themeToggle = document.getElementById('themeToggle');
    
    // ‰ªé localStorage ‰∏≠Ëé∑Âèñ‰øùÂ≠òÁöÑ‰∏ªÈ¢ò
    const savedTheme = localStorage.getItem('theme');
    
    // Â¶ÇÊûúÊúâ‰øùÂ≠òÁöÑ‰∏ªÈ¢òÔºåÂ∫îÁî®ÂÆÉ
    if (savedTheme) {
        document.documentElement.setAttribute('data-theme', savedTheme);
        themeToggle.checked = savedTheme === 'dark';
    }
    
    // ÁõëÂê¨ÂàáÊç¢ÊåâÈíÆÁöÑÂèòÂåñ
    themeToggle.addEventListener('change', (e) => {
        if (e.target.checked) {
            document.documentElement.setAttribute('data-theme', 'dark');
            localStorage.setItem('theme', 'dark');
            console.log("1");
        } else {
            document.documentElement.setAttribute('data-theme', 'light');
            localStorage.setItem('theme', 'light');
            console.log("2");
        }
    });

    // Ê£ÄÊµãÁ≥ªÁªü‰∏ªÈ¢òÂÅèÂ•Ω
    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)');
    
    // Â¶ÇÊûúÊ≤°Êúâ‰øùÂ≠òÁöÑ‰∏ªÈ¢òÔºå‰ΩøÁî®Á≥ªÁªüÂÅèÂ•Ω
    if (!savedTheme) {
        if (prefersDark.matches) {
            document.documentElement.setAttribute('data-theme', 'dark');
            themeToggle.checked = true;
        }
    }

    // ÁõëÂê¨Á≥ªÁªü‰∏ªÈ¢òÂèòÂåñ
    prefersDark.addListener((e) => {
        if (!localStorage.getItem('theme')) {
            if (e.matches) {
                document.documentElement.setAttribute('data-theme', 'dark');
                themeToggle.checked = true;
            } else {
                document.documentElement.setAttribute('data-theme', 'light');
                themeToggle.checked = false;
            }
        }
    });
</script>
{% endblock %}